#!/bin/bash
# Decision Log - ADR (Architecture Decision Record) v1.0.0

DECISIONS_DIR="$HOME/skippy/documentation/decisions"
mkdir -p "$DECISIONS_DIR"

# Get next decision number
NEXT_NUM=$(ls -1 "$DECISIONS_DIR" 2>/dev/null | grep -E '^[0-9]+' | sort -n | tail -1 | cut -d- -f1 || echo "0")
NEXT_NUM=$((NEXT_NUM + 1))
NEXT_NUM=$(printf "%04d" $NEXT_NUM)

echo "═══ Decision Log (ADR-$NEXT_NUM) ═══"
echo ""

read -p "Decision title: " TITLE
read -p "Context (why is this needed?): " CONTEXT
read -p "Decision (what did you decide?): " DECISION
read -p "Consequences: " CONSEQUENCES
read -p "Alternatives considered: " ALTERNATIVES
read -p "Status (proposed/accepted/deprecated): " STATUS

FILENAME="${NEXT_NUM}-${TITLE// /-}.md"
FILEPATH="$DECISIONS_DIR/$FILENAME"

cat > "$FILEPATH" <<EOF
# ${NEXT_NUM}. ${TITLE}

**Date:** $(date +%Y-%m-%d)
**Status:** ${STATUS:-proposed}
**Deciders:** $(git config user.name || echo "Unknown")

---

## Context

$CONTEXT

## Decision

$DECISION

## Consequences

$CONSEQUENCES

## Alternatives Considered

$ALTERNATIVES

## Related Decisions

- (Link to related decisions)

---

**Last Updated:** $(date +%Y-%m-%d)
EOF

echo ""
echo "✅ Decision logged: $FILEPATH"
echo ""
echo "Reference: ADR-$NEXT_NUM"

# Update index
if [[ ! -f "$DECISIONS_DIR/INDEX.md" ]]; then
    echo "# Decision Log Index" > "$DECISIONS_DIR/INDEX.md"
    echo "" >> "$DECISIONS_DIR/INDEX.md"
fi

echo "- [ADR-$NEXT_NUM: $TITLE](./$FILENAME)" >> "$DECISIONS_DIR/INDEX.md"
